# é¡¹ç›®ç»“æ„è¯´æ˜ï¼ˆæ–°æ¶æ„ï¼‰

## ğŸ“ ç›®å½•ç»“æ„

```
dundun-watch/
â”œâ”€â”€ src/                      # Worker æºä»£ç ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ index.js             # ä¸»å…¥å£ï¼šè·¯ç”±åˆ†å‘
â”‚   â”œâ”€â”€ api.js               # API æ¥å£å¤„ç†
â”‚   â”œâ”€â”€ monitor.js           # ç›‘æ§é€»è¾‘ï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰
â”‚   â””â”€â”€ utils.js             # å·¥å…·å‡½æ•°
â”‚
â”œâ”€â”€ frontend/                 # å‰ç«¯é¡¹ç›®ï¼ˆä¿æŒä¸å˜ï¼‰
â”‚   â”œâ”€â”€ src/                 # React æºç 
â”‚   â”œâ”€â”€ public/              # é™æ€èµ„æº
â”‚   â”œâ”€â”€ dist/                # æ„å»ºäº§ç‰©ï¼ˆè¢« Worker Assets ä½¿ç”¨ï¼‰
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.js
â”‚
â”œâ”€â”€ .github/workflows/        # CI/CD
â”‚   â”œâ”€â”€ deploy-merged.yml    # æ–°çš„åˆå¹¶éƒ¨ç½²å·¥ä½œæµ
â”‚   â””â”€â”€ deploy.yml           # æ—§çš„åˆ†ç¦»éƒ¨ç½²ï¼ˆå¯åˆ é™¤ï¼‰
â”‚
â”œâ”€â”€ worker/                   # æ—§çš„ Worker ä»£ç ï¼ˆå¯åˆ é™¤ï¼‰
â”‚   â””â”€â”€ src/
â”‚
â”œâ”€â”€ wrangler.toml            # Worker é…ç½®æ–‡ä»¶ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ package.json             # é¡¹ç›®ä¸»é…ç½®ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ QUICKSTART.md            # å¿«é€Ÿå¼€å§‹æŒ‡å—ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ æœ¬åœ°å¼€å‘æŒ‡å—.md          # è¯¦ç»†å¼€å‘æ–‡æ¡£ï¼ˆæ–°å¢ï¼‰
â””â”€â”€ README.md                # é¡¹ç›®è¯´æ˜
```

## ğŸ”„ æ¶æ„å˜åŒ–

### æ—§æ¶æ„ï¼ˆåˆ†ç¦»å¼ï¼‰
```
Worker (Cron + ç›‘æ§é€»è¾‘)
    â†“
  KV å­˜å‚¨
    â†‘
Pages (å‰ç«¯ + API Functions)
```

**é—®é¢˜ï¼š**
- éœ€è¦ç»´æŠ¤ä¸¤ä¸ªé¡¹ç›®
- ä¸¤ä¸ªéƒ¨ç½²æµç¨‹
- Pages Functions é™åˆ¶è¾ƒå¤š
- é…ç½®è¾ƒå¤æ‚

### æ–°æ¶æ„ï¼ˆåˆå¹¶å¼ï¼‰
```
Worker (å‰ç«¯ + API + Cron)
    â”œâ”€â”€ Workers Assets (é™æ€èµ„æº)
    â””â”€â”€ KV å­˜å‚¨
```

**ä¼˜åŠ¿ï¼š**
- âœ… å•ä¸€é¡¹ç›®ï¼Œæ˜“äºç»´æŠ¤
- âœ… ç»Ÿä¸€éƒ¨ç½²æµç¨‹
- âœ… æ›´å¥½çš„æ€§èƒ½
- âœ… æ›´ç®€å•çš„é…ç½®
- âœ… æœ¬åœ°å¼€å‘æ›´æ–¹ä¾¿

## ğŸ“„ æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

### src/index.js
ä¸»å…¥å£æ–‡ä»¶ï¼Œå¤„ç†ï¼š
- HTTP è¯·æ±‚è·¯ç”±ï¼ˆAPI vs é™æ€èµ„æºï¼‰
- Cron å®šæ—¶ä»»åŠ¡è°ƒåº¦

```javascript
export default {
  async fetch(request, env, ctx) {
    // API è¯·æ±‚ â†’ api.js
    // é™æ€èµ„æº â†’ Workers Assets
  },
  async scheduled(event, env, ctx) {
    // å®šæ—¶ç›‘æ§ â†’ monitor.js
  }
}
```

### src/api.js
æ‰€æœ‰ API æ¥å£å¤„ç†ï¼š
- `/api/login` - ç™»å½•
- `/api/status` - è·å–çŠ¶æ€
- `/api/sites` - ç«™ç‚¹ç®¡ç†
- `/api/config` - é…ç½®ç®¡ç†
- `/api/incidents` - äº‹ä»¶è®°å½•
- ç­‰ç­‰...

ä» `frontend/functions/api/[[path]].js` è¿ç§»è€Œæ¥ã€‚

### src/monitor.js
ç›‘æ§æ ¸å¿ƒé€»è¾‘ï¼š
- ç«™ç‚¹å¯ç”¨æ€§æ£€æµ‹
- SSL è¯ä¹¦æ£€æµ‹
- é€šçŸ¥å‘é€ï¼ˆä¼ä¸šå¾®ä¿¡/é‚®ä»¶ï¼‰
- å†å²æ•°æ®è®°å½•

ä» `worker/src/monitor.js` è¿ç§»è€Œæ¥ã€‚

### src/utils.js
å·¥å…·å‡½æ•°ï¼š
- æ—¶é—´æ ¼å¼åŒ–
- æ•°æ®å¤„ç†
- ç­‰ç­‰...

### wrangler.toml
Worker é…ç½®æ–‡ä»¶ï¼š

```toml
name = "dundun-watch"
main = "src/index.js"

[assets]
directory = "./frontend/dist"  # Workers Assets é…ç½®

kv_namespaces = [
  { binding = "MONITOR_DATA", id = "..." }
]

[triggers]
crons = ["* * * * *", "0 4 * * *"]  # å®šæ—¶ä»»åŠ¡
```

## ğŸš€ éƒ¨ç½²æµç¨‹

### æœ¬åœ°æµ‹è¯•
```bash
npm run dev         # æœ¬åœ°å¼€å‘
npm run build       # æ„å»ºå‰ç«¯
```

### ç”Ÿäº§éƒ¨ç½²
```bash
npm run deploy      # ä¸€é”®éƒ¨ç½²
```

æˆ–ä½¿ç”¨ GitHub Actionsï¼š
1. æäº¤ä»£ç åˆ° main åˆ†æ”¯
2. è‡ªåŠ¨è§¦å‘éƒ¨ç½²
3. è®¿é—® `https://dundun-watch.your-account.workers.dev`

## ğŸ”§ å¼€å‘å·¥ä½œæµ

### ä¿®æ”¹ Worker ä»£ç 
```bash
# ç¼–è¾‘ src/ ä¸‹çš„æ–‡ä»¶
npm run dev  # è‡ªåŠ¨çƒ­é‡è½½
```

### ä¿®æ”¹å‰ç«¯ä»£ç 
```bash
cd frontend
npm run dev  # å‰ç«¯çƒ­é‡è½½ï¼ˆæ›´å¿«ï¼‰
```

### å®Œæ•´æµ‹è¯•
```bash
npm run build:frontend  # æ„å»ºå‰ç«¯
npm run dev             # å¯åŠ¨ Worker
```

## ğŸ“¦ æ•°æ®å­˜å‚¨

### Workers KV
```
é”®å                å€¼
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
monitor_state       ç›‘æ§çŠ¶æ€ï¼ˆJSONï¼‰
admin_password      ç®¡ç†å‘˜å¯†ç 
admin_path          åå°è·¯å¾„
```

## ğŸ—‘ï¸ å¯ä»¥åˆ é™¤çš„æ–‡ä»¶

åˆå¹¶å®Œæˆåï¼Œè¿™äº›æ–‡ä»¶å¯ä»¥å®‰å…¨åˆ é™¤ï¼š

```
worker/                     # æ—§çš„ Worker ä»£ç 
frontend/functions/         # Pages Functionsï¼ˆå·²è¿ç§»åˆ° src/api.jsï¼‰
.github/workflows/deploy.yml  # æ—§çš„éƒ¨ç½²æµç¨‹
```

ä¿ç•™å»ºè®®ï¼š
- å…ˆæµ‹è¯•æ–°æ¶æ„è¿è¡Œæ­£å¸¸
- ç¡®è®¤æ•°æ®è¿ç§»æˆåŠŸ
- å†åˆ é™¤æ—§æ–‡ä»¶

## âš™ï¸ é…ç½®è¿ç§»

### GitHub Secretsï¼ˆæ— éœ€ä¿®æ”¹ï¼‰
```
CLOUDFLARE_API_TOKEN  # Cloudflare API ä»¤ç‰Œ
ADMIN_PASSWORD        # ç®¡ç†å‘˜å¯†ç ï¼ˆå¯é€‰ï¼‰
ADMIN_PATH           # åå°è·¯å¾„ï¼ˆå¯é€‰ï¼‰
```

### KV æ•°æ®ï¼ˆè‡ªåŠ¨è¿ç§»ï¼‰
éƒ¨ç½²æ—¶ä¼šè‡ªåŠ¨ä½¿ç”¨ç°æœ‰çš„ KV å‘½åç©ºé—´ï¼Œæ•°æ®æ— ç¼è¿ç§»ã€‚

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **æµ‹è¯•æ–°æ¶æ„**
   ```bash
   npm run dev
   ```

2. **ç¡®è®¤åŠŸèƒ½æ­£å¸¸**
   - è®¿é—®å‰ç«¯ç•Œé¢
   - æµ‹è¯• API æ¥å£
   - æ£€æŸ¥ç›‘æ§ä»»åŠ¡

3. **éƒ¨ç½²åˆ°ç”Ÿäº§**
   ```bash
   npm run deploy
   ```

4. **æ¸…ç†æ—§æ–‡ä»¶**
   - åˆ é™¤ `worker/` ç›®å½•
   - åˆ é™¤ `frontend/functions/`
   - åˆ é™¤æ—§çš„ workflow æ–‡ä»¶

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [QUICKSTART.md](./QUICKSTART.md) - å¿«é€Ÿå¼€å§‹
- [æœ¬åœ°å¼€å‘æŒ‡å—.md](./æœ¬åœ°å¼€å‘æŒ‡å—.md) - è¯¦ç»†å¼€å‘æ–‡æ¡£
- [README.md](./README.md) - é¡¹ç›®è¯´æ˜
